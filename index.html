<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Generator & Verifier</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PDF & Image Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Google Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;800&family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&display=swap');
        
        .font-header { font-family: 'Cinzel', serif; }
        .font-body { font-family: 'Cormorant Garamond', serif; }
        
        /* Custom Colors */
        .text-gold { color: #b49b57; }
        .border-gold { border-color: #b49b57; }
        .bg-gold { background-color: #b49b57; }
        .bg-parchment { background-color: #fffcf5; }

        @media print {
            .no-print { display: none !important; }
            body { margin: 0; padding: 0; background: white; }
            .print-area { 
                display: flex !important; 
                width: 100% !important; 
                height: 100vh !important;
                position: fixed;
                top: 0; left: 0;
                margin: 0; padding: 0;
                background-color: #fffcf5 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                z-index: 9999;
            }
            @page { size: landscape; margin: 0; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICON COMPONENTS (Inline SVGs to avoid dependency issues) ---
        const IconPrinter = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>;
        const IconUpload = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>;
        const IconReset = () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="1 4 1 10 7 10"></polyline><polyline points="23 20 23 14 17 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path></svg>;
        const IconUser = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
        const IconAward = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>;
        const IconQrCode = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
        const IconImage = () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>;
        const IconFileText = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>;
        const IconCheckCircle = () => <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500 mx-auto mb-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        const IconAlert = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;

        function App() {
            const [isViewerMode, setIsViewerMode] = useState(false);
            const [data, setData] = useState({
                candidateName: "Alex Morgan",
                description: "For outstanding dedication and remarkable contribution to the community project. Your hard work and commitment have been an inspiration to us all.",
                founderName: "Sarah Connor",
                signatoryTitle: "Founder / Head",
                founderEmail: "sarah@institution.org",
                date: new Date().toISOString().split('T')[0],
                institutionName: "Royal Academy of Arts",
                title: "Certificate of Appreciation",
                verificationUrl: ""
            });

            const [image, setImage] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);
            const fileInputRef = useRef(null);
            const certificateRef = useRef(null);

            // 1. Initialize: Check URL params to see if this was opened via QR code
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                if (params.has('verify')) {
                    setIsViewerMode(true);
                    setData({
                        candidateName: params.get('name') || "",
                        description: params.get('desc') || "",
                        founderName: params.get('sig') || "",
                        signatoryTitle: params.get('role') || "",
                        founderEmail: params.get('mail') || "",
                        date: params.get('date') || "",
                        institutionName: params.get('inst') || "",
                        title: params.get('title') || "",
                        verificationUrl: window.location.href
                    });
                }
                
                // Set the current URL as the default verification URL if empty (for new users)
                if (!params.has('verify') && window.location.hostname !== 'localhost' && window.location.protocol !== 'file:') {
                     setData(prev => ({...prev, verificationUrl: window.location.href.split('?')[0]}));
                }
            }, []);

            const generateVerificationLink = () => {
                // If the user provided a custom URL, use it. Otherwise generate the magic link.
                if (data.verificationUrl && !data.verificationUrl.includes(window.location.hostname)) {
                    return data.verificationUrl;
                }

                const baseUrl = window.location.href.split('?')[0];
                const params = new URLSearchParams({
                    verify: 'true',
                    name: data.candidateName,
                    desc: data.description,
                    sig: data.founderName,
                    role: data.signatoryTitle,
                    mail: data.founderEmail,
                    date: data.date,
                    inst: data.institutionName,
                    title: data.title
                });
                return `${baseUrl}?${params.toString()}`;
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setData(prev => ({ ...prev, [name]: value }));
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const imageUrl = URL.createObjectURL(file);
                    setImage(imageUrl);
                }
            };

            const handlePrint = () => window.print();

            const handleDownloadPDF = async () => {
                setIsGenerating(true);
                try {
                    const element = certificateRef.current;
                    const canvas = await window.html2canvas(element, {
                        scale: 2, 
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#fffcf5', 
                        logging: false
                    });
                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('l', 'mm', 'a4');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    pdf.save(`${data.candidateName.replace(/\s+/g, '_')}_Certificate.pdf`);
                } catch (error) {
                    console.error("PDF error:", error);
                    alert("PDF Generation failed. Try 'Print' -> 'Save as PDF'.");
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleDownloadImage = async () => {
                setIsGenerating(true);
                try {
                    const element = certificateRef.current;
                    const canvas = await window.html2canvas(element, {
                        scale: 2, useCORS: true, allowTaint: true, backgroundColor: '#fffcf5'
                    });
                    const link = document.createElement('a');
                    link.download = `${data.candidateName.replace(/\s+/g, '_')}_Certificate.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (error) {
                    console.error("Image error:", error);
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleReset = () => {
                if (window.confirm("Clear all fields?")) {
                    setData({
                        candidateName: "",
                        description: "",
                        founderName: "",
                        signatoryTitle: "",
                        founderEmail: "",
                        date: new Date().toISOString().split('T')[0],
                        institutionName: "",
                        title: "Certificate of Appreciation",
                        verificationUrl: ""
                    });
                    setImage(null);
                }
            };

            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&ecc=L&margin=10&data=${encodeURIComponent(generateVerificationLink())}`;

            // --- VIEWER MODE (Mobile/Scan View) ---
            if (isViewerMode) {
                return (
                    <div className="min-h-screen bg-gray-900 flex flex-col items-center justify-center p-4">
                        <div className="bg-white p-4 rounded-lg shadow-lg mb-6 max-w-md w-full text-center">
                            <IconCheckCircle />
                            <h1 className="text-xl font-bold text-gray-800">Verified Certificate</h1>
                            <p className="text-gray-600 text-sm">Valid digital copy of the issued document.</p>
                        </div>
                        
                        <div className="w-full max-w-4xl overflow-hidden rounded-lg shadow-2xl bg-parchment relative border-4 border-slate-800">
                             <div className="bg-parchment relative text-slate-900 p-8 flex flex-col items-center text-center">
                                <div className="absolute inset-2 border-2 border-gold pointer-events-none"></div>
                                <IconAward className="w-12 h-12 text-slate-800 mx-auto mb-2" />
                                <h2 className="text-lg font-header font-bold text-slate-800 uppercase tracking-widest mb-1">{data.institutionName}</h2>
                                <h1 className="text-xl font-header font-black text-gold uppercase border-b-2 border-slate-900 pb-2 px-4 mb-4">{data.title}</h1>
                                <p className="font-body text-slate-500 italic mb-2">Awarded to</p>
                                <div className="text-2xl font-header font-bold text-slate-900 mb-4 uppercase">{data.candidateName}</div>
                                <p className="text-sm font-body leading-relaxed text-slate-700 mb-6">{data.description}</p>
                                <div className="flex justify-between w-full text-xs font-bold uppercase text-slate-500 border-t border-slate-300 pt-4">
                                    <span>Date: {data.date}</span>
                                    <span>Signed: {data.founderName}</span>
                                </div>
                             </div>
                        </div>
                    </div>
                );
            }

            // --- EDITOR MODE ---
            return (
                <div className="flex flex-col lg:flex-row min-h-screen">
                    <div className="no-print w-full lg:w-1/3 bg-white p-6 shadow-xl z-10 overflow-y-auto border-r border-gray-200 h-screen">
                        <div className="mb-6 border-b pb-4">
                            <h1 className="text-2xl font-header font-bold text-slate-800 flex items-center gap-2">
                                <IconAward className="w-6 h-6 text-yellow-600" />
                                Certificate Editor
                            </h1>
                        </div>

                        <div className="space-y-4">
                             <div className="bg-amber-50 border border-amber-200 p-3 rounded text-xs text-amber-800 flex items-start gap-2">
                                <span className="mt-0.5"><IconAlert /></span>
                                <p>To make the QR code work for everyone, upload this <code>index.html</code> to <strong>GitHub Pages</strong>, copy the resulting link, and paste it into the "Verification URL" box below.</p>
                            </div>

                            <div className="flex flex-col gap-2 mb-6">
                               <button onClick={handleDownloadPDF} disabled={isGenerating} className="w-full bg-slate-800 hover:bg-slate-900 text-yellow-50 px-4 py-3 rounded shadow-md font-header font-bold text-sm tracking-widest flex items-center justify-center gap-2 transition-all uppercase disabled:opacity-50">
                                    <IconFileText /> Download PDF
                               </button>
                               <div className="grid grid-cols-2 gap-2">
                                  <button onClick={handleDownloadImage} disabled={isGenerating} className="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded shadow font-bold text-xs tracking-widest flex items-center justify-center gap-2 transition-all uppercase disabled:opacity-50">
                                    <IconImage /> Download PNG
                                  </button>
                                  <button onClick={handlePrint} className="bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 px-3 py-2 rounded shadow font-bold text-xs tracking-widest flex items-center justify-center gap-2 transition-all uppercase">
                                    <IconPrinter /> Print
                                  </button>
                               </div>
                            </div>

                            <div className="p-4 border-2 border-dashed border-yellow-600/30 rounded-lg hover:border-yellow-600/60 transition-colors text-center cursor-pointer bg-yellow-50/30" onClick={() => fileInputRef.current.click()}>
                                <input type="file" ref={fileInputRef} onChange={handleImageUpload} className="hidden" accept="image/*" />
                                <div className="w-12 h-12 mx-auto mb-2 rounded-full border-2 border-yellow-600/20 flex items-center justify-center bg-white overflow-hidden">
                                    {image ? <img src={image} className="w-full h-full object-cover" /> : <IconUpload />}
                                </div>
                                <p className="text-xs font-semibold text-slate-700">{image ? "Change Logo" : "Upload Logo"}</p>
                            </div>

                            <input type="text" name="title" value={data.title} onChange={handleInputChange} placeholder="Title" className="w-full px-3 py-2 border border-slate-300 rounded text-sm" />
                            <input type="text" name="institutionName" value={data.institutionName} onChange={handleInputChange} placeholder="Institution" className="w-full px-3 py-2 border border-slate-300 rounded text-sm" />
                            <input type="text" name="candidateName" value={data.candidateName} onChange={handleInputChange} placeholder="Recipient Name" className="w-full px-3 py-2 border border-slate-300 rounded text-sm font-semibold" />
                            <textarea name="description" value={data.description} onChange={handleInputChange} rows={3} placeholder="Citation" className="w-full px-3 py-2 border border-slate-300 rounded text-sm"></textarea>
                            
                            <div className="grid grid-cols-2 gap-2">
                                <input type="date" name="date" value={data.date} onChange={handleInputChange} className="w-full px-3 py-2 border border-slate-300 rounded text-sm" />
                                <input type="text" name="founderName" value={data.founderName} onChange={handleInputChange} placeholder="Signatory Name" className="w-full px-3 py-2 border border-slate-300 rounded text-sm" />
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2">
                                <input type="text" name="signatoryTitle" value={data.signatoryTitle} onChange={handleInputChange} placeholder="Title (e.g. Founder)" className="w-full px-3 py-2 border border-slate-300 rounded text-sm" />
                                <input type="email" name="founderEmail" value={data.founderEmail} onChange={handleInputChange} placeholder="Email" className="w-full px-3 py-2 border border-slate-300 rounded text-sm" />
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Verification URL</label>
                                <div className="relative">
                                    <div className="absolute left-3 top-2.5"><IconQrCode /></div>
                                    <input type="text" name="verificationUrl" value={data.verificationUrl} onChange={handleInputChange} className="w-full pl-9 pr-3 py-2 border border-slate-300 rounded text-sm" placeholder="https://your-site.github.io/..." />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 bg-slate-800 p-4 lg:p-8 overflow-auto flex items-center justify-center">
                        <div ref={certificateRef} className="print-area bg-parchment shadow-2xl relative text-slate-900" style={{ width: '297mm', height: '210mm', minWidth: '297mm', minHeight: '210mm' }}>
                            <div className="absolute inset-4 border-[6px] border-slate-900 z-10"></div>
                            <div className="absolute inset-6 border-[2px] border-gold z-10"></div>
                            
                            <div className="absolute top-6 left-6 w-16 h-16 border-t-[4px] border-l-[4px] border-slate-900 z-20"></div>
                            <div className="absolute top-8 left-8 w-12 h-12 border-t-[1px] border-l-[1px] border-gold z-20"></div>
                            <div className="absolute top-6 right-6 w-16 h-16 border-t-[4px] border-r-[4px] border-slate-900 z-20"></div>
                            <div className="absolute top-8 right-8 w-12 h-12 border-t-[1px] border-r-[1px] border-gold z-20"></div>
                            <div className="absolute bottom-6 left-6 w-16 h-16 border-b-[4px] border-l-[4px] border-slate-900 z-20"></div>
                            <div className="absolute bottom-8 left-8 w-12 h-12 border-b-[1px] border-l-[1px] border-gold z-20"></div>
                            <div className="absolute bottom-6 right-6 w-16 h-16 border-b-[4px] border-r-[4px] border-slate-900 z-20"></div>
                            <div className="absolute bottom-8 right-8 w-12 h-12 border-b-[1px] border-r-[1px] border-gold z-20"></div>

                            <div className="relative h-full flex flex-col items-center justify-between pt-16 pb-12 px-24 z-30">
                                <div className="w-full flex flex-col items-center">
                                    <div className="relative mb-4">
                                        <div className="w-28 h-28 rounded-full border-[4px] border-slate-900 bg-white flex items-center justify-center overflow-hidden shadow-lg relative z-10">
                                            {image ? <img src={image} className="w-full h-full object-cover" /> : <IconAward className="w-10 h-10 text-slate-300" />}
                                        </div>
                                        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-36 h-[2px] bg-gold -z-0"></div>
                                    </div>
                                    <h2 className="text-2xl font-header font-bold text-slate-800 uppercase tracking-widest mb-1">{data.institutionName}</h2>
                                    <p className="font-body text-slate-600 text-lg italic mb-4">is honored to present</p>
                                    <h1 className="text-4xl font-header font-black text-gold drop-shadow-sm uppercase tracking-wider border-b-2 border-slate-900 pb-2 px-12">{data.title}</h1>
                                </div>

                                <div className="w-full text-center my-2 flex-grow flex flex-col justify-center">
                                    <p className="font-body text-xl text-slate-500 mb-2 italic">to</p>
                                    <div className="text-5xl font-header font-bold text-slate-900 mb-4 px-4 tracking-wide uppercase">{data.candidateName}</div>
                                    <div className="max-w-3xl mx-auto">
                                        <p className="text-xl font-body leading-relaxed text-slate-700">{data.description}</p>
                                    </div>
                                </div>

                                <div className="w-full flex justify-between items-end mt-4">
                                    <div className="flex flex-col items-center w-56">
                                        <div className="w-full border-b border-slate-400 mb-2 text-center pb-1"><span className="font-header text-lg font-bold text-slate-800">{data.date}</span></div>
                                        <span className="font-header text-xs font-bold text-slate-500 uppercase tracking-widest">Date</span>
                                    </div>

                                    <div className="relative mx-4 flex flex-col items-center">
                                        <div className="w-32 h-32 rounded-full bg-gradient-to-br from-yellow-400 via-yellow-600 to-yellow-800 shadow-md flex items-center justify-center p-1.5">
                                            <div className="w-full h-full rounded-full border-2 border-yellow-200 border-dashed flex items-center justify-center bg-white overflow-hidden">
                                                <img src={qrCodeUrl} className="w-24 h-24 mix-blend-multiply" />
                                            </div>
                                        </div>
                                        <span className="font-header text-[10px] font-bold tracking-widest text-slate-600 mt-2 uppercase">Scan to Verify</span>
                                    </div>

                                    <div className="flex flex-col items-center w-56">
                                        <div className="w-full border-b border-slate-400 mb-2 text-center pb-1 min-h-[30px] flex items-end justify-center">
                                            <span className="font-header text-xl font-bold text-slate-900 uppercase">{data.founderName}</span>
                                        </div>
                                        <span className="font-header text-xs font-bold text-slate-800 uppercase tracking-wide">{data.signatoryTitle}</span>
                                        <span className="font-body text-xs text-slate-500 italic mt-0.5">{data.founderEmail}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
